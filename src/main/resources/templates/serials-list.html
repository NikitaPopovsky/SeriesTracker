<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Список сериалов</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .poster-img {
            max-width: 100px;
            height: auto;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .description-cell {
            width: 300px;
            height: 100px;
            padding: 8px;
            display: table-cell;
            vertical-align: middle;
        }
        .description-content {
            width: 100%;
            height: 100%;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 5;
            -webkit-box-orient: vertical;
            text-overflow: ellipsis;
            word-break: break-word;
            white-space: normal;
            line-height: 1.4;
            margin: 0;
        }
        .table-fixed {
            table-layout: fixed;
        }
        tr {
            height: 100px;
        }
        td {
            vertical-align: middle !important;
        }
    </style>
</head>
<body>
<div class="container mt-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>Мои сериалы</h1>
        <a href="/search" class="btn btn-primary">Найти сериал</a>
    </div>

    <div class="table-responsive">
        <table class="table table-hover table-fixed">
            <thead class="table-light">
            <tr>
                <th style="width: 50px;">ID</th>
                <th style="width: 100px;">Постер</th>
                <th style="width: 150px;">Название</th>
                <th style="width: 150px;">Оригинальное название</th>
                <th style="width: 100px;">Дата выхода</th>
                <th style="width: 300px;">Описание</th>
                <th style="width: 100px;">Страна</th>
                <th style="width: 150px;">Действия</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="serial : ${serialList}">
                <td th:text="${serial.id}"></td>
                <td>
                    <img th:if="${serial.posterPath}"
                         th:src="${'https://image.tmdb.org/t/p/w200' + serial.posterPath}"
                         alt="Постер сериала"
                         class="poster-img">
                    <div th:unless="${serial.posterPath}" class="text-muted">Нет постера</div>
                </td>
                <td th:text="${serial.name}"></td>
                <td th:text="${serial.originalName}"></td>
                <td>
                    <span th:if="${serial.firstAirDate}" th:text="${#strings.substring(serial.firstAirDate, 0, 10)}"></span>
                    <span th:unless="${serial.firstAirDate}" class="text-muted">-</span>
                </td>
                <td class="description-cell">
                    <div class="description-content" th:text="${serial.overview}"></div>
                </td>
                <td>
                    <span th:each="country : ${serial.originCountry}"
                          th:text="${country}"
                          class="badge bg-secondary me-1"></span>
                </td>
                <td>
                    <div class="btn-group btn-group-sm">
                        <a href="#" class="btn btn-outline-info">Подробнее</a>
                        <button class="btn btn-outline-danger delete-btn" th:data-id="${serial.id}">Удалить</button>
                    </div>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    document.querySelectorAll('.delete-btn').forEach(btn => {
        btn.addEventListener('click', async function() {
            const id = this.getAttribute('data-id');
            if (confirm('Вы уверены, что хотите удалить этот сериал?')) {
                try {
                    const response = await fetch(`/api/v1/delete?id=${id}`, {
                        method: 'DELETE'
                    });

                    if (response.ok) {
                        window.location.reload();
                    } else {
                        alert('Ошибка при удалении');
                    }
                } catch (error) {
                    console.error('Ошибка:', error);
                    alert('Произошла ошибка при удалении');
                }
            }
        });
    });
</script>
</body>
</html>